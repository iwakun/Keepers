import { Component, ElementRef, Input, OnChanges, EventEmitter, Output } from '@angular/core';
declare var noUiSlider:any;

@Component({
    selector: 'macu-slider',
    template: '<div id="slider"></div>'
})
export class MacuSliderComponent implements OnChanges {
    @Input() range;
    @Input() value;
    @Input() selectionType;
    @Output() sliderChange = new EventEmitter();

    isset:boolean = false;
    slider:any;
    el:any;

    constructor(el:ElementRef) {
        this.el = el.nativeElement;
        this.isset = false;
    }

    ngOnChanges() {
        this.slider = this.el.getElementsByTagName('div')[0];
        if(!this.isset && typeof this.range != 'undefined') {
            noUiSlider.create(this.slider, {
                start: 1,
                step: 1,
                range: {
                    'min': 1,
                    'max': this.range.length
                }
            });
            this.slider.noUiSlider.on('update', (values) => {
                this.sliderChange.emit({
                    value: this.range[values[0] - 1],
                    type: this.selectionType
                });
            });
            this.isset = true;
        }
        if(this.isset) {
            for(var i = 0; i < this.range.length; i++) {
                if(this.range[i] == this.value) {
                    this.slider.noUiSlider.set(i + 1);
                }
            }
        }
    }
}
