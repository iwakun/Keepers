<?php
require_once('includes/boot.inc.php');

// Get id, redirect if no id is set
$id = (!empty($_GET['id'])) ? intval($_GET['id']) : false;
if(!$id) {
    Notice::error('No course specified');
    Page::redirect();
}

$course = new Course($id);
$previews = $course->getPreviews();

if($course->status == Course::DELETED) {
    Notice::errror("This course has been deleted");
    Page::redirect();
}

if($course->status == Course::UNDERMAINTENANCE) {
    Notice::warning("This course is currently under maintenance
        and unavailable for viewing. If you have any questions, please
        <a href=\"/pages/contact.php\">contact us</a>.");
}

if($course->seo_title) {
    $p->title = $course->seo_title;
} else {
    $p->title = "{$course->getTitle()} - {$course->category} Training - Online Training Course";
}
$p->description = $course->meta_description;
$p->keywords = $course->meta_keywords;
$p->addMetaTag('category', $course->category);
$p->addScript('/js/gogogh_courses.js');
$p->head_content = '<link rel="canonical" href="http://gogotraining.com'.$course->getUrl().'">'."\n";
$p->addOnDocReady("log('$user->id', 'gogogh_courses', '$id');");
?>
<?php include(GG_ROOT.'/includes/header.php'); ?>
<div class="main-banner">
    <div class="main-banner-background">
        <div class="main-banner-background-mask"></div>
    </div>
    <div class="main-banner-content">
        <h1>
            <?= $course->getTitle() ?>
            <?php if($course->subtitle): ?>
                <span class="subtitle"><?= $course->subtitle ?></span>
            <?php endif; ?>
        </h1>
        <div class="banner-content-details">
            <div class="item-details">
                <div class="item-details-focus">
                    <h2>In This Course You Will Learn How To:</h2>
                    <?= $course->objectives ?>
                </div>
                <div class="item-details-links-container">
                    <!--<div class="item-details-links-shadow"></div>-->
                    <div class="item-details-links">
                        <div class="link" data-component="overlay">
                            Description
                            <div data-overlay-content>
                                <div data-overlay-header>
                                    <h2>Description</h2>
                                </div>
                                <div data-overlay-body>
                                    <?= $course->description ?>
                                </div>
                            </div>
                        </div>
                        <?php if($course->prerequisites): ?>
                            <div class="link" data-component="overlay">
                                Prerequisites
                                <div data-overlay-content>
                                    <div data-overlay-header>
                                        <h2>Prerequisites</h2>
                                    </div>
                                    <div data-overlay-body>
                                        <?= $course->prerequisites ?>
                                    </div>
                                </div>
                            </div>
                        <?php endif; ?>
                        <?php if($course->outline): ?>
                            <div class="link" data-component="overlay">
                                Outline
                                <div data-overlay-content>
                                    <div data-overlay-header>
                                        <h2>Outline</h2>
                                    </div>
                                    <div data-overlay-body>
                                        <?= $course->outline ?>
                                    </div>
                                </div>
                            </div>
                        <?php endif; ?>
                        <?php if($course->certification): ?>
                            <div class="link" data-component="overlay">
                                Certification
                                <div data-overlay-content>
                                    <div data-overlay-header>
                                        <h2>Certification</h2>
                                    </div>
                                    <div data-overlay-body>
                                        <?= $course->certification ?>
                                    </div>
                                </div>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            <div class="course-intro">
                <div class="enroll-callout">
                    <?php if($user->canPurchaseCourse($course->id)): ?>
                        <span><strong>Enroll in</strong> This Course</span>
                        <a
                            class="button button-primary-medium"
                            data-action="purchase-options"
                            rel="#purchase-options-<?= $course->id; ?>"
                            href="#">
                            Add to Cart
                        </a>
                    <?php endif; ?>
                </div>
                <div class="social-links">
                    <p>Share this Course</p>
                    <ul class="social">
                        <?php
                        $siteurl = urlencode('http://gogotraining.com'.$course->getUrl());
                        $sitetitle = urlencode("GogoTraining - ".$course->getTitle());
                        ?>
                        <li>
                            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=<?= $siteurl ?>&amp;title=<?= $sitetitle ?>" target="_blank">
                                <span class="fa fa-linkedin"></span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/dialog/feed?app_id=970982146314824&amp;display=popup&amp;link=<?= $siteurl ?>&amp;redirect_uri=http://gogotraining.com<?= $course->getUrl() ?>" target="_blank">
                                <span class="fa fa-facebook"></span>
                            </a>
                        </li>
                        <li>
                            <a href="http://twitter.com/timeline/home?status=<?= $siteurl ?>" target="_blank">
                                <span class="fa fa-twitter"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="main single-page single-page-course">
    <div class="single-main" data-component="content-drawer">
        <div class="course-videos" data-cd="default">
            <div class="single-section videos-faq" data-component="overlay">
                <div class="section-link">
                    <span class="fa fa-film"></span>
                    Need Help Playing Your Videos?
                </div>
                <div data-overlay-content>
                    <div data-overlay-header>
                        <h2>What should I do if my video will not play?</h2>
                    </div>
                    <div data-overlay-body>
                        <?php include(GG_ROOT.'/pages/_faq-videos.php'); ?>
                    </div>
                </div>
            </div>
            <div class="table" data-component="transcript" data-transcript-course-id="<?= $course->id ?>">
                <div class="table-row row-head">
                    <div class="table-cell">Video Title</div>
                    <div class="table-cell">Length</div>
                    <?php if($user->hasCourseEvenExpired($course->id)): ?>
                        <div class="table-cell">% Completed</div>
                    <?php endif; ?>
                </div>
                <?php foreach($course->getModules() as $module): ?>
                    <?php if($module->type == 'video'): ?>
                        <div class="table-row" data-transcript-module-id="<?= $module->id ?>">
                            <div class="table-cell">
                                <?php if($user->canViewModule($module->id)): ?>
                                    <a <?= $module->getModuleLink(); ?>>
                                        <span class="fa fa-play"></span>
                                        <?= $module->getTitle(); ?>
                                    </a>
                                <?php else: ?>
                                    <?= $module->getTitle(); ?>
                                <?php endif; ?>
                            </div>
                            <div class="table-cell">
                                <?= $module->length ?> min
                            </div>
                            <?php if($user->hasCourseEvenExpired($course->id)): ?>
                                <div class="table-cell">
                                    <span
                                        data-transcript="bar"
                                        class="data-transcript">
                                        <span class="fa fa-refresh fa-spin"></span> Loading...
                                    </span>
                                    <span data-transcript="percentage">0%</span>
                                </div>
                            <?php endif; ?>
                        </div>
                    <?php elseif($module->type == 'quiz'): ?>
                        <div class="table-row">
                            <div class="table-cell">
                                <?php if($user->canViewVideos($course->id)): ?>
                                    <a <?= $module->getModuleLink() ?>>
                                        <span class="fa fa-pencil-square-o"></span>
                                        <?= $module->title ?>
                                    </a>
                                <?php else: ?>
                                    <?= $module->title ?>
                                <?php endif; ?>
                            </div>
                            <div class="table-cell"></div>
                            <?php if($user->hasCourseEvenExpired($course->id)): ?>
                                <div class="table-cell"></div>
                            <?php endif; ?>
                        </div>
                    <?php endif; ?>
                <?php endforeach; ?>
                <div class="table-row">
                    <div class="table-cell" style="text-align: right;">
                        Total:
                    </div>
                    <div class="table-cell">
                        <?= $course->getLength() ?>
                    </div>
                    <div class="table-cell" data-transcript="total">
                        <span
                            data-transcript="bar"
                            class="data-transcript">
                            <span class="fa fa-refresh fa-spin"></span> Loading...
                        </span>
                        <span data-transcript="percentage">0%</span>
                    </div>
                </div>
            </div>
        </div>
        <?php if($user->canViewQA($course->id)): ?>
            <div class="course-forum" data-cd="drawer" data-cd-id="forum">
                <h2>Question and Answer Forum</h2>
                <?php $comments = $course->getComments(); ?>
                <form
                    class="form comment-form"
                    id="commentform-<?= $course->id; ?>"
                    data-depth="0"
                    action="/includes/ajax/comment.php"
                    method="post">
                    <fieldset>
                        <legend>Ask A Question</legend>
                        <input
                            type="hidden"
                            name="parent_id"
                            value="0">
                        <input
                            type="hidden"
                            name="depth"
                            value="0">
                        <input
                            type="hidden"
                            name="course_id"
                            value="<?= $course->id ?>">
                        <input
                            type="hidden"
                            name="return_link"
                            value="http://<?= GG_DOMAIN ?><?= $course->getUrl(); ?>">
                        <textarea class="validate" name="comment_text"></textarea>
                        <ul>
                            <li>All questions will also be mailed to the content author.</li>
                            <li>All questions are subject to moderation.</li>
                            <li>
                                All questions and comments are automatically
                                emailed to the requester and the instructor and
                                recorded.
                            </li>
                            <li>Responses are provided within 24 hours.</li>
                        </ul>
                        <button
                            class="button button-secondary-small"
                            type="submit"
                            name="comment-submit">
                            Submit Question
                        </button>
                        <div id="notice-commentform-<?= $course->id; ?>" class="notice"></div>
                    </fieldset>
                </form>

                <!-- List the comments -->
                <div class="comments" id="comments-listing-commentform-<?= $course->id ?>">
                    <?php if(!empty($comments)): ?>
                        <?php foreach($comments as $comment): ?>
                            <?php include(GG_ROOT.'/training/courses/_comment.php'); ?>
                        <?php endforeach; ?>
                    <?php endif; ?>
                </div>
            </div>
        <?php endif; ?>
    </div>
    <div class="single-secondary">
        <div class="single-secondary-callout">
            <h3>
                Online Video Training from the Best Instructors in the World!
            </h3>
            <div class="enroll-callout">
                <?php if($user->canPurchaseCourse($course->id)): ?>
                    <span><strong>Enroll in</strong> This Course</span>
                    <br>
                    <a
                        class="button button-primary-medium"
                        data-action="purchase-options"
                        rel="#purchase-options-<?= $course->id; ?>"
                        href="#">
                        Add to Cart
                    </a>
                <?php endif; ?>
            </div>
        </div>
        <div class="single-secondary-sections">
            <?php if($course->hardware_requirements): ?>
                <div class="single-section computer" data-component="accordion">
                    <div class="section-link" data-accordion="link">
                        <span class="section-icon"></span>Setting up Your Computer
                    </div>
                    <div class="section-content" data-accordion="content">
                        <div class="section-content-inner">
                            <?php if($course->hardware_requirements): ?>
                                <h2>System Requirements</h2>
                                <?= $course->hardware_requirements ?>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            <?php endif; ?>
            <?php if(($course->getDownloads() && !$course->isRetired())): ?>
                <div class="single-section book" data-component="accordion">
                    <div class="section-link" data-accordion="link">
                        <span class="section-icon"></span>Get Your Course Materials
                    </div>
                    <div class="section-content" data-accordion="content">
                        <div class="section-content-inner">
                            <h2>Course Materials</h2>
                            <?php if(!$user->canViewMaterials($course->id)): ?>
                                <p>When you purchase this course you will
                                receive access to these materials.</p>
                            <?php endif; ?>
                            <ul>
                                <?php foreach($course->getDownloads() as $item): ?>
                                    <li>
                                        <?php if($user->canViewMaterials($course->id)): ?>
                                            <a
                                                href="/training/courses/download.php?type=downloads&amp;id=<?= $item['id'] ?>"
                                                target="_blank">
                                                <?= $item['name'] ?>
                                            </a>
                                        <?php else: ?>
                                            <?= $item['name'] ?>
                                        <?php endif; ?>
                                    </li>
                                <?php endforeach; ?>
                            </ul>
                            <?php if($course->getMaterials()): ?>
                                <h2>Additional Items Available for Purchase</h2>
                                <?php if(!$user->isLoggedIn()): ?>
                                    <p>You must be logged in to purchase.</p>
                                <?php endif; ?>
                                <?php foreach($course->getMaterials() as $material): ?>
                                    <div class="course-materials">
                                        <h4><?= $material['name']; ?></h4>
                                        <div class="course-materials-text">
                                            <?= $material['description']; ?>
                                            <?php if($user->canViewMaterials($course->id)): ?>
                                                <div class="course-material">
                                                    <?php if($user->hasMaterials($material['id'])): ?>
                                                        <a
                                                            class="button button-primary-small"
                                                            href="/training/courses/download.php?id=<?= $material['id'] ?>">
                                                            Download
                                                        </a>
                                                    <?php else: ?>
                                                        <a
                                                            class="button button-primary-small"
                                                            href="/shop/?item=materials|<?= $material['id'] ?>">
                                                            $<?= $material['cost']; ?> - Add To Cart
                                                        </a>
                                                    <?php endif; ?>
                                                </div>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                <?php endforeach; ?>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            <?php endif; ?>
            <?php if($course->getLinks()): ?>
                <div class="single-section checkbox" data-component="accordion">
                    <div class="section-link" data-accordion="link">
                        <span class="section-icon"></span>Course Links
                    </div>
                    <div class="section-content" data-accordion="content">
                        <div class="section-content-inner">
                            <h2>Course Links</h2>
                            <?php if(!$user->hasCourseEvenExpired($course->id)): ?>
                                <p>These links are activated when you purchase this course.</p>
                            <?php endif; ?>
                            <ul>
                                <?php foreach($course->getLinks() as $item): ?>
                                    <li>
                                        <?php if($user->hasCourseEvenExpired($course->id)): ?>
                                            <a href="<?= $item['link'] ?>" target="_blank">
                                                <?= $item['name'] ?>
                                            </a>
                                        <?php else: ?>
                                            <?= $item['name'] ?>
                                        <?php endif; ?>
                                    </li>
                                <?php endforeach; ?>
                            </ul>
                        </div>
                    </div>
                </div>
            <?php endif; ?>
            <div class="single-section printer" data-component="accordion">
                <div class="section-link" data-accordion="link">
                    <span class="section-icon"></span>Course Transcript
                </div>
                <div class="section-content" data-accordion="content">
                    <div class="section-content-inner">
                        <h2>Transcript</h2>
                        <?php if(!$user->canViewTranscript($course->id)): ?>
                            <p> This course comes with a Transcript that tracks
                            your progress. You can use your transcript to view
                            and monitor your progress and when you complete the
                            course, you can print or email the transcript, or
                            print a course completion certificate.</p>
                        <?php else: ?>
                            <p>Click here to View, Print and Email your Transcript.</p>
                            </p>
                            <p>
                                <a
                                    class="button button-primary-small"
                                    target="_blank"
                                    href="/training/courses/transcript.php?id=<?= $course->id ?>">
                                    View Transcript
                                </a>
                            </p>
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            <div class="single-section certificate" data-component="accordion">
                <div class="section-link" data-accordion="link">
                    <span class="section-icon"></span>Certificate of Completion
                </div>
                <div class="section-content" data-accordion="content">
                    <div class="section-content-inner">
                        <h2>Certificate of Completion</h2>
                        <?php if($user->canViewCompletionCertificate($course->id)): ?>
                            <?php $transcript = $user->getTranscript($course->id); ?>
                            <?php if($transcript['total_percent'] > 95): ?>
                                <img class="certificate-sample" src="/images/certificate-sample.png">
                                <a
                                    class="button button-primary-small"
                                    target="_blank"
                                    href="/training/courses/completion-certificate.php?id=<?= $course->id; ?>">
                                    Download Certificate
                                </a>
                            <?php else: ?>
                                <p>When you complete this course you will
                                receive a Course Completion Certificate
                                Download Link so you can print and/or email
                                your Certificate of Completion.</p>
                                <img class="certificate-sample" src="/images/certificate-sample.png">
                            <?php endif; ?>
                        <?php else: ?>
                            <p>You will be awarded a Certificate of Completion
                            when you finish this course.  You will be able to
                            print or email the certificate and share your
                            accomplishment with everyone.</p>
                            <img class="certificate-sample" src="/images/certificate-sample.png">
                        <?php endif; ?>
                    </div>
                </div>
            </div>
            <?php if($course->certification): ?>
                <div class="single-section certificate" data-component="accordion">
                    <div class="section-link" data-accordion="link">
                        <span class="section-icon"></span>How to Take Your Exam
                    </div>
                    <div class="section-content" data-accordion="content">
                        <div class="section-content-inner">
                            <h2>How to Take Your Exam</h2>
                            <?= $course->certification ?>
                        </div>
                    </div>
                </div>
            <?php endif; ?>
            <?php if($user->hasCourse($course->id)): ?>
                <div class="single-section checkbox" data-component="accordion">
                    <div class="section-link" data-accordion="link">
                        <span class="section-icon"></span>Rate This Course
                    </div>
                    <div class="section-content" data-accordion="content">
                        <div class="section-content-inner">
                            <h2>Course Survey</h2>
                            <?php foreach($course->getLinks() as $item): // Get course survey ?>
                                <?php if(stristr($item['name'], 'course survey')): ?>
                                    <p>Your input is important to us.  Be sure to
                                    rate this course by filling out the course
                                    survey.</p>
                                    <p>
                                        <a href="<?= $item['link']; ?>">
                                            <?= $item['name']; ?>
                                        </a>
                                    </p>
                                <?php else: ?>
                                    <?= $item['name']; ?>
                                <?php endif; ?>
                            <?php endforeach; ?>
                        </div>
                    </div>
                </div>
            <?php endif; ?>
            <?php if($course->can_comment): ?>
                <div class="single-section teacher" data-component="accordion">
                    <div class="section-link" data-accordion="link">
                        <span class="section-icon"></span>Ask the Instructor a Question
                    </div>
                    <div class="section-content" data-accordion="content">
                        <div class="section-content-inner">
                            <h2>QA Forum</h2>
                            <?php if($user->canViewQA($course->id)): ?>
                                <a
                                    data-cd="open"
                                    data-target="forum"
                                    class="button button-primary-small">
                                    Open QA Forum
                                </a>
                            <?php else: ?>
                                <?php if($course->isOneDollarADayCourse()): ?>
                                    <p>Interested in an Instructor Support Package?
                                    <a href="/pages/buy-support.php?id=<?= $course->id ?>">Click here</a>
                                    to receive information on how to join the
                                    Instructor Access Forum.</p>
                                <?php endif; ?>
                                <?php if($course->isTwoDollarADayCourse()): ?>
                                    <p>When you purchase this course you will
                                    be able to use the QA Forum and have direct
                                    access to the instructor.</p>
                                <?php endif; ?>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            <?php endif; ?>
        </div>
    </div>
</div>
<?php include(GG_ROOT.'/includes/overlay/types.php'); ?>
<?php include(GG_ROOT.'/includes/footer.php'); ?>
